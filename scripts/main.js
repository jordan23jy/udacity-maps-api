$.ajax({dataType:"json",url:"model.json",type:"GET",success:function(o){model=new ViewModel(o),ko.applyBindings(model)},error:function(){alert("something went wrong")}});var ViewModel=function(o){var e=this,t={copy:["title","loc","lat","id"]};ko.mapping.fromJS(o,t,e),this.markerArray=ko.observableArray([]),this.currentLocation=ko.observable(""),this.query=ko.observable(""),this.foursquare=ko.observable(""),this.filteredMarkers=ko.computed(function(){return ko.utils.arrayFilter(e.markerArray(),function(o){return o.title.toLowerCase().indexOf(e.query().toLowerCase())>=0})},this);var n=o.locations;this.filteredMarkers.subscribe(function(){e.markerArray().forEach(function(o){o.setMap(null)}),e.filteredMarkers().forEach(function(o){o.setMap(s)})});var r,a,i={mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(38.897947,-77.036509),zoom:14,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_BOTTOM},disableDefaultUI:!1,panControl:!1},s=new google.maps.Map(document.getElementById("map-canvas"),i),l=new google.maps.InfoWindow;for(a=0;a<n.length;a++)r=new google.maps.Marker({position:new google.maps.LatLng(n[a].lat,n[a].lng),title:n[a].title,map:s,animation:google.maps.Animation.DROP,id:n[a].id}),e.markerArray.push(r),google.maps.event.addListener(r,"click",function(o){return function(){e.setLocation(o)}}(r));this.setLocation=function(o){e.currentLocation()===o?e.removeLocation():(e.getFoursquare(o),e.removeLocation(),e.currentLocation(o),o.setAnimation(google.maps.Animation.BOUNCE),l.setContent(o.title),l.open(s,o))},this.removeLocation=function(){e.currentLocation()&&(e.currentLocation().setAnimation(null),e.currentLocation(null),l.close())};this.getFoursquare=function(o){$.ajax({dataType:"json",cache:!0,url:"https://api.foursquare.com/v2/venues/"+o.id+"?client_id=JZZWQ2GOQCFO4J1R03HFTPFMOTNMTQFRGV5XQ2S0KHQYPVMZ&client_secret=HC1KWRSYXWW5TBRBPW4DKDPH4TEXEVAZQK34GXLW2X1D315G&v=20130815",type:"GET",success:function(o){e.foursquare(o.response.venue)},error:function(){alert("unable to retrieve information")}})}};